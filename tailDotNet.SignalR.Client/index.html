<!DOCTYPE html>
<html>
<head>
	<title>SignalR Simple Chat</title>
	<link href="Content/bootstrap.min.css" rel="stylesheet"/>
	<style type="text/css">
		body {
			background-color: #222;
		}
		.container
		{
			background-color: #99CCFF;
			border: thick solid #808080;
			padding: 20px;
			margin: 20px;
		}
		.tailOutputContainer {
			margin: 0;
			padding: 20px;
			background-color: #000;
			color: #0f0;
			font-family: monospace;
		}
	</style>
</head>
<body>
	<div class="container">
		<input type="text" id="message" />
		<input type="button" id="sendmessage" value="Send" />
		<input type="hidden" id="displayname" />
		<ul id="discussion"></ul>
	</div>
	<div>
		<button id="remoteTailBtn" class="btn btn-primary">Select file</button>
	</div>
	<div class="tailOutputContainer">
		<input id="fileToTail" type="text" />
	</div>
	<!--Script references. -->
	<!--Reference the jQuery library. -->
	<script src="Scripts/jquery-1.9.0.min.js"></script>
	<!--Reference the SignalR library. -->
	<script src="Scripts/jquery.signalR-2.1.2.min.js"></script>
	<!--Reference the autogenerated SignalR hub script. -->
	<script src="http://localhost:8080/signalr/hubs"></script>
	<!--Add script to update the page and send messages.-->
	<script type="text/javascript">
		var chat = null;
		function fileSelected() {
			var file = document.getElementById('fileToTail').files[0];
			if (file) {
				var fileSize = 0;
				if (file.size > 1024 * 1024)
					fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';
				else
					fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';
			}
		}

		$(function () {
			//Set the hubs URL for the connection
			$.connection.hub.url = "http://localhost:8080/signalr";

			// Declare a proxy to reference the hub.
			chat = $.connection.myHub;

			// Create a function that the hub can call to broadcast messages.
			chat.client.addMessage = function (name, message) {
				// Html encode display name and message.
				var encodedName = $('<div />').text(name).html();
				var encodedMsg = $('<div />').text(message).html();
				// Add the message to the page.
				$('#discussion').append('<li><strong>' + encodedName
					+ '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
			};


			chat.client.printVolumes = function(volumes) {
				console.log(JSON.stringify(volumes));
			};

			// Get the user name and store it to prepend to messages.
			$('#displayname').val(prompt('Enter your name:', ''));
			// Set initial focus to message input box.
			$('#message').focus();
			// Start the connection.
			$.connection.hub.start().done(function () {
				$('#sendmessage').click(function () {
					// Call the Send method on the hub.
					chat.server.send($('#displayname').val(), $('#message').val());
					// Clear text box and reset focus for next comment.
					$('#message').val('').focus();
				});

				$('#fileToTail').change(function () {
					chat.server.tail($(this).val());
				});

				$('#remoteTailBtn').click(function() {
					chat.server.getVolumes();
				});
			});
		});
	</script>
</body>
</html>
